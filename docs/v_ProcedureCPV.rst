.. _v_ProcedureCPV:

v_ProcedureCPV
==============

Змінна містить собі CPV код процедури.

**Формат:**  Рядок.

**Рівень розрахунку:** Процедура закупівлі

**Частота розрахунку:** Змінна розраховується один раз 

Дані, що використовуються для розрахунку
----------------------------------------

Для розрахунку використовуються:

* - API тендерінгу системи публічних закупівель
* - таблиця cpv_catalogue

Поля для розрахунку:

- ``data.items.classification.id``

Формула розрахунку
------------------

1. Вибираємо усі ``data.items.classification.id`` процедури.
2. З таблиці cpv_catalogue знаходимо найменший спльний батьківський код: для кожного коду з п.1 знаходимо в cpv_catalogue значення CPV4. Якщо CPV4 співпадає для усіх кодів з п.1, то цей CPV4 і є найменшим батьківським кодом.
3. Якщо CPV4 не найменший батьківський код, то порівнюємо CPV3 для всіх кодів з п.1. Якщо CPV3 співпадає для всіх кодів з п.1, то він і є найменшим батьківським кодом.
4. Якщо CPV3 не найменший батьківський код, то найменший бальківський код буде CPV2 будь якого ``data.items.classification.id`` процедури.
